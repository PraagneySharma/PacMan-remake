/**
 * @(#)Player.java
 *
 *
 * @author 
 * @version 1.00 2024/4/5
 */
import java.awt.*;
import java.util.ArrayList;

public class OrangeGhost extends Ghost{
    private boolean attack = true;
    public static final int gate = 4;
    public int counter = 0;
    public int numberOfMovementsCounter = 0;
    public int totalNumberOfMovements;
    public int orangeFrightenedLength;
    public boolean orangeFrightenedMode = false;
    

    private static Image []ghostImages;
    
    
    public OrangeGhost(int ghostStartingX, int ghostStartingY, int speed, int releaseTime) { 
        super(ghostStartingX, ghostStartingY, speed, releaseTime);

        if(ghostImages == null){
            ghostImages = new Image[10];
            for(int i=0; i<10; i++){
                 ghostImages[i] = Util.loadImage(String.format("GhostAnimations/orange/ghost%03d.png", i));
            }
        }
        orangeFrightenedLength = GamePanel.frightenedLength[GamePanel.level];

    }

    public void move(boolean []keys, ArrayList<Wall> WallsList, int[][] grid, Pacman pacman, RedGhost redGhost, CyanGhost cyanGhost, PinkGhost pinkGhost, OrangeGhost orangeGhost){
        totalNumberOfMovements =GamePanel.TILEHEIGHT*2 / getSpeed();
        setLevelDelayFrames(getLevelDelayFrames()-1);
        if (getLevelDelayFrames()>0){
            return;
        }
        setReleaseTime(getReleaseTime()-1);
        if (getReleaseTime()>0){
            if (getCurrentDirection() == "LEFT" && !collideWall(WallsList, getX()-getSpeed(), getY(), getCurrentDirection())){
                setX(getX() - getSpeed());
            }
            else{
                setCurrentDirection("RIGHT");
            }
            if (getCurrentDirection() == "RIGHT" && !collideWall(WallsList, getX()+getSpeed(), getY(), getCurrentDirection())){
                setX(getX() + getSpeed());
            }
            else{
                setCurrentDirection("LEFT");
            }
            return;
        }
        if (orangeFrightenedMode){
            frightenedCollide(pacman);
        }
        if (isCentered()){
            if (collideWithGate(grid)){
                setExitingGate(true);
                setCurrentDirection("UP");   
            }
        }
        if (getExitingGate()){
            if (numberOfMovementsCounter < totalNumberOfMovements){
                setY(getY()-getSpeed());
                numberOfMovementsCounter++;
            }
            else{
                setExitingGate(false);
                numberOfMovementsCounter = 0;
            }
        }
        else
        if (!getExitingGate()){
            if (getCurrentDirection() == "LEFT" && !collideWall(WallsList, getX(), getY(), getCurrentDirection())){
                setX(getX()-getSpeed());
            }
            if (getCurrentDirection() == "RIGHT" && !collideWall(WallsList, getX(), getY(), getCurrentDirection())){
                setX(getX()+getSpeed());
            }
            if (getCurrentDirection() == "UP" && !collideWall(WallsList, getX(), getY(), getCurrentDirection())){
                setY(getY()-getSpeed());
            }
            if (getCurrentDirection() == "DOWN" && !collideWall(WallsList, getX(), getY(), getCurrentDirection())){
                setY(getY()+getSpeed());
            }
            if (collideWall(WallsList, getX(), getY(), getCurrentDirection()) || isAtIntersection(WallsList)){
                ArrayList<String> availableDirections = getAvailableDirections(WallsList);
                int randomDirectionIndex = Util.randint(0, availableDirections.size()-1);
                setCurrentDirection(availableDirections.get(randomDirectionIndex));
            }
        }
        if(getX()<=-getWidth()/2){ //if the player goes off the screen to the left, wrap around to the right
            setX(GamePanel.WIDTH - getWidth());
        }
        else if(getX()>=GamePanel.WIDTH-getWidth()/2){ //if the player goes off the screen to the right, wrap around to the left
            setX(0);
        }
    }
    public void reset(){
        setX(GamePanel.orangeGhostStartingX);
        setY(GamePanel.orangeGhostStartingY);
        setExitingGate(false);
        setCurrentDirection("LEFT");
        setReleaseTime(GamePanel.orangeghostRelease[GamePanel.level]);
        setLevelDelayFrames(GamePanel.levelDelayFrames);
    }
    public void frightenedCollide(Pacman pacman){
        orangeFrightenedLength--;
        if (orangeFrightenedLength==0){
            setOrangeFrightenedLength(GamePanel.frightenedLength[GamePanel.level]);
            orangeFrightenedMode = false;
        }
        if (getRect().intersects(pacman.getRect())){
            reset();
            orangeFrightenedMode = false;
        }
    }
    public boolean getOrangeFrightenedMode(){
        return orangeFrightenedMode;
    }
    public void setOrangeFrightenedMode(boolean orangeFrightenedMode){
        this.orangeFrightenedMode = orangeFrightenedMode;
    }
    public int getOrangeFrightenedLength(){
        return orangeFrightenedLength;
    }
    public void setOrangeFrightenedLength(int orangeFrightenedLength){
        this.orangeFrightenedLength = orangeFrightenedLength;
    }

    public void draw(Graphics g, ArrayList<Wall> WallList, Pacman pacman){
        int ghostImage = updateGhostImage(WallList);
        counter++;
        if (counter == 16){
                counter = 0;
            }
        if (getOrangeFrightenedMode()){
            if(counter < 8){
                g.drawImage(getGhostImage1(), getX()+4, getY(), getX()+getWidth(), getY()+getHeight(), 0, 0, getWidth(), getHeight(), null);
            }
            else{
                g.drawImage(getGhostImage2(), getX()+4, getY(), getX()+getWidth(), getY()+getHeight(), 0, 0, getWidth(), getHeight(), null);           
            }
        }
        else{  
            if(counter < 8){
                g.drawImage(ghostImages[ghostImage], getX()+4, getY(), getX()+getWidth(), getY()+getHeight(), 0, 0, getWidth(), getHeight(), null);
            }
            else{
                g.drawImage(ghostImages[ghostImage+1], getX()+4, getY(), getX()+getWidth(), getY()+getHeight(), 0, 0, getWidth(), getHeight(), null);           
            }
        }
    }
    public Rectangle getRect(){
        return new Rectangle(getX(), getY(), getWidth(), getHeight());
    }

    public static void main(String[] arguments) {
        new Main();
    }
    
}